---
title: "Data Experimentation"
author: "Nabih Estefan"
date: 12-3-2020
output:
  github_document:
    toc: true
---

```{r setup, echo=FALSE}
library(tidyverse)
library(forcats)
```

```{r load-data, message=FALSE}
game_genres <- "./data/game_genres.csv"
df_genre <- read_csv(game_genres) %>% rename(genre = Genre)

game_ids <- "./data/game_ids.csv"
df_ids <- read_csv(game_ids)

player_data <- "./data/player_data.csv"
df_player <- 
  read_csv(player_data) %>% 
  filter(action == "play") %>% 
  select(user_id, name, hours)
```

```{r summary}
summary(df_genre)
summary(df_ids)
summary(df_player)
```
```{r join-data}
df_game <-
  df_genre %>% 
  left_join(df_ids, by = "appid") %>% 
  select(name, genre) %>% 
  drop_na() %>% 
  unique() %>% 
  mutate(
    name = str_remove(name, ":"),
    name = str_replace(name, "â€™", "'")
  )

df_data <-
  df_player %>% 
    left_join(df_game, by = "name")

df_data[is.na(df_data)] <- "Unidentified"

summary(df_data)
```
```{r players}
df_data %>% 
  filter(hours != 0) %>% 
    select(user_id, genre) %>% 
      unique() %>% 
        ggplot(aes(fct_infreq(genre))) +
        geom_histogram(stat = "count")
```

```{r playtime}
df_data %>% 
  group_by(genre) %>% 
    summarize(Average_Playtime_Genre = mean(hours))%>% 
      mutate (genre = fct_reorder(genre, Average_Playtime_Genre)) %>% 
        ggplot(aes(Average_Playtime_Genre, genre)) +
        geom_col() 
```

```{r playtime-percentage}
df_data %>% 
  group_by (user_id) %>% 
    select(!genre) %>% 
      unique %>% 
        summarize(total_plyhrs = sum(hours)) %>% 
              filter(total_plyhrs > 20) %>%
          left_join(df_data, by = "user_id") %>% 
            mutate(playPerc = hours/total_plyhrs)%>% 
              group_by(genre) %>% 
                summarize(Average_PlayPerc_Genre = mean(playPerc)) %>% 
                  mutate (genre = fct_reorder(genre, Average_PlayPerc_Genre)) %>% 
                    ggplot(aes(Average_PlayPerc_Genre, genre)) +
                    geom_col()
```

```{r FTP-and-Strat}
df_data %>% 
  group_by (user_id) %>% 
    select(!genre) %>% 
      unique %>% 
        summarize(total_plyhrs = sum(hours)) %>%  
          left_join(df_data, by = "user_id") %>% 
            mutate(playPerc = hours/total_plyhrs)%>% filter(genre == c("Free to Play")) %>% 
                group_by(name) %>% 
                summarize(Average_PlayPerc_Genre = mean(playPerc)) %>% 
                  filter(Average_PlayPerc_Genre > 0.1) %>% 
                  mutate (name = fct_reorder(name, Average_PlayPerc_Genre)) %>% 
                    ggplot(aes(Average_PlayPerc_Genre, name)) +
                    geom_col()
```

